<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TWR Calculator | h0tp-ftw</title>
    <link rel="stylesheet" href="../assets/styles.css">
    <link rel="stylesheet" href="assets/niche.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body data-theme="frappe">
    <!-- Back Button -->
    <div class="niche-back-nav">
        <a href="../index.html#niche-projects" class="back-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
            Back to Portfolio
        </a>
    </div>

    <!-- Main Content -->
    <div class="niche-container">
        <header class="niche-header">
            <h1>üìä Time-Weighted Return Calculator</h1>
            <p class="niche-subtitle">Calculate accurate portfolio returns accounting for cash flows</p>
        </header>

        <div class="calculator-grid">
            <!-- Input Section -->
            <div class="calculator-card">
                <h2>üìù Portfolio Data</h2>

                <div class="input-group">
                    <label for="start-date">Start Date</label>
                    <input type="date" id="start-date" class="calc-input">
                </div>

                <div class="input-group">
                    <label for="start-balance">Starting Balance ($)</label>
                    <input type="number" id="start-balance" class="calc-input" placeholder="10000" step="0.01">
                </div>

                <h3>Cash Flows</h3>
                <div id="cash-flows-container">
                    <!-- Dynamic cash flows will be added here -->
                </div>

                <button class="add-flow-btn" id="add-flow-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 5v14M5 12h14"/>
                    </svg>
                    Add Cash Flow
                </button>

                <div class="button-group">
                    <button class="calc-btn primary" id="calculate-btn">Calculate TWR</button>
                    <button class="calc-btn secondary" id="reset-btn">Reset</button>
                </div>
            </div>

            <!-- Results Section -->
            <div class="calculator-card">
                <h2>üìà Results</h2>

                <div id="results-container" class="results-hidden">
                    <div class="result-stat">
                        <span class="result-label">Time-Weighted Return</span>
                        <span class="result-value" id="twr-result">-</span>
                    </div>

                    <div class="result-stat">
                        <span class="result-label">Simple Return</span>
                        <span class="result-value" id="simple-return">-</span>
                    </div>

                    <div class="result-stat">
                        <span class="result-label">Total Gain/Loss</span>
                        <span class="result-value" id="total-gain">-</span>
                    </div>

                    <div class="result-stat">
                        <span class="result-label">Ending Balance</span>
                        <span class="result-value" id="end-balance">-</span>
                    </div>

                    <canvas id="twr-chart"></canvas>

                    <button class="calc-btn export" id="export-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 16l-5-5h3V4h4v7h3l-5 5zM5 20h14v2H5v-2z"/>
                        </svg>
                        Export to CSV
                    </button>
                </div>

                <div id="results-placeholder" class="results-placeholder">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor" opacity="0.3">
                        <path d="M3 13h2v8H3v-8zm4-6h2v14H7V7zm4 10h2v4h-2v-4zm4-6h2v10h-2V11zm4-4h2v14h-2V7z"/>
                    </svg>
                    <p>Enter your portfolio data and click Calculate</p>
                </div>
            </div>
        </div>

        <!-- Explanation Section -->
        <div class="explanation-card">
            <h2>ü§î What is Time-Weighted Return?</h2>
            <p>
                Time-Weighted Return (TWR) measures the compound rate of growth in a portfolio,
                removing the effects of cash flows (deposits and withdrawals). This makes it ideal
                for comparing investment performance regardless of when you added or removed money.
            </p>

            <h3>Formula</h3>
            <div class="formula">
                TWR = [(1 + R‚ÇÅ) √ó (1 + R‚ÇÇ) √ó ... √ó (1 + R‚Çô) - 1] √ó 100%
            </div>
            <p class="formula-note">Where R‚ÇÅ, R‚ÇÇ, ..., R‚Çô are the returns for each period between cash flows.</p>

            <h3>TWR vs Simple Return</h3>
            <ul>
                <li><strong>TWR:</strong> Removes timing effects of cash flows. Better for performance evaluation.</li>
                <li><strong>Simple Return:</strong> (End Value - Start Value - Net Flows) / Start Value. Affected by deposit timing.</li>
            </ul>
        </div>
    </div>

    <script src="assets/niche.js"></script>
    <script src="assets/twr-calculator.js"></script>
</body>
</html>
